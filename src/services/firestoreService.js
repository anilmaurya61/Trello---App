import { getFirestore, collection, doc, setDoc, query, where, getDocs, deleteDoc } from "firebase/firestore";
import app from './firebaseConfig'

const db = getFirestore(app);

const createBoard = async (boardData) => {
  try {
    const autoGeneratedId = doc(collection(db, 'boards'));

    await setDoc(autoGeneratedId, { ...boardData, id: autoGeneratedId.id });

    console.log('Board created with ID: ', autoGeneratedId.id);

    return autoGeneratedId.id;
  } catch (e) {
    console.error('Error creating board: ', e);
    throw e;
  }
};

const getBoards = async (userId) => {
  try {
    const q = await query(collection(db, "boards"), where("userId", "==", userId));

    const querySnapshot = await getDocs(q);

    const boards = querySnapshot.docs.map((doc) => ({
      ...doc.data(),
    }));

    return boards;
  }
  catch (e) {
    throw e;
  }
}

const deleteBoard = async (id) => {
  try {
    await deleteDoc(doc(db, "boards", id));
    return true;
  } catch (err) {
    console.log(err);
    throw err;
  }
};

export { createBoard, getBoards, deleteBoard };
